<html>
<head>
	<title>Polytech EDT3D</title>
	<style>canvas { width: 100%; height: 100% }</style>
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

	<script type="text/javascript" src="./js/jquery-1.11.0.js"></script>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script src="./js/three.js"></script>
	<script type="text/javascript" src="./js/edt3d.js"></script>
</head>
<body>
	<div class="container">
		<form role="form">
			<div class="form-group">
				<label for="fileInput">File input</label>
				<input type="file" id="fileInput">
			</div>
			<textarea class="form-control" id="parseResult" rows="30"></textarea>
		</form>

		<div class="row">
			<div ></div>
		</div>
	</div>
	<script type="text/javascript">
		var eventList = []; //global

		window.onload = function()
		{
			var fileInput=document.getElementById('fileInput');
			var fileContent = document.getElementById('parseResult');
			fileInput.addEventListener('change', function(e){

				//Not testing file type
				if(true )
				{
					var reader = new FileReader();
					reader.onload=function(){
						var regEvent = new RegExp("BEGIN:VEVENT[\\s\\S]{1,40}DTSTART:"+new Date().yyyymmdd()+"[\\s\\S]{1,500}END:VEVENT", "g");
						
						fileContent.innerText = reader.result.match(regEvent);
						
						var regTmp = new RegExp("(,?\"[A-Z-]*):","g");
						reader.result.match(regEvent).forEach(function(e){
							var json = "{"+ 
								e.replace(/BEGIN:VEVENT\r?\n/g,"\"") //remove the beginning
								 .replace(/\r?\nEND:VEVENT/g,"\"")	 //remove the end
								 .replace(/\r?\n([^A-Z])/g, "$1")	 //remove illegal new line
								 .replace(/\r?\n/g,"\",\"")			 //new line to ,
								 .replace(regTmp, "$1\":\"")		 //: to ":"
								 +"}";
							// log(json);
							eventList.push(JSON.parse(json));
						})
						// log(eventList.length)
						//Now we get all event of today in the list
						// log(eventList[0].DESCRIPTION)
					};
					reader.readAsText(file);
				}else fileContent.innerText = "File type not supported!"
			});
		}
	</script>
</body>
</html>